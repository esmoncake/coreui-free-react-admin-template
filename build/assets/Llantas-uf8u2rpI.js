import{r as t,j as a}from"./index-Cq3cNOe4.js";import{a as m}from"./axios-Bl1vbFzL.js";import{C as _,a as aa,b as V,c as u,d as ea,e as x,h as sa,E as la}from"./jspdf.es.min-DhbDYEgH.js";import{a as r,c as S}from"./index.esm-BVbxNr3O.js";import{C as ta,a as oa}from"./CRow-CR1dTeP1.js";import{C as na,a as ra}from"./CCardBody-BZy5Kcki.js";import{C as ia}from"./CCardHeader-Drjisk7v.js";import{c as ca,a as da,b as ha,d as ma}from"./cil-trash-BnkbpAXr.js";import{C as j}from"./CFormInput-CPK1Hc24.js";import{C as T,a as A,b as D,c as k}from"./CModalHeader-DM5zFOOe.js";import{C as w}from"./CFormSelect-sMFcUcNb.js";import{C as ua}from"./CAlert-BYmA3n6A.js";import"./DefaultLayout-VGzP6Txu.js";const Na=()=>{const[d,C]=t.useState([]),[B,z]=t.useState([]),[i,N]=t.useState(null),[$,p]=t.useState(!1),[q,g]=t.useState(!1),[U,f]=t.useState(!1),[o,I]=t.useState({}),[n,F]=t.useState({marca:"",medida:"",estado:"",idMatricula:""}),[h,W]=t.useState(""),[P,H]=t.useState([]);t.useEffect(()=>{const e=async()=>{try{const l=await m.get("http://localhost:4000/llantas");C(l.data)}catch(l){c("Error fetching llantas: "+l.message)}};(async()=>{try{const l=await m.get("http://localhost:4000/automoviles");z(l.data)}catch{c("Error fetching automoviles")}})(),e()},[]);const c=e=>{H([...P,{message:e}]),setTimeout(()=>{H(s=>s.slice(1))},5e3)},J=async()=>{if(!n.marca.trim()||!n.medida.trim()||!n.estado.trim()||!n.idMatricula.trim()){c("Todos los campos son obligatorios.");return}try{const e=await m.post("http://localhost:4000/llantas",n);C([...d,e.data]),g(!1),F({marca:"",medida:"",estado:"",idMatricula:""})}catch(e){c("Error adding llantas: "+e.message)}},K=async()=>{if(!i){c("No se ha seleccionado ninguna llanta.");return}try{await m.delete(`http://localhost:4000/llantas/${i}`),C(d.filter(e=>e.id!==i)),N(null),f(!1)}catch(e){c("Error deleting llantas: "+e.message)}},O=e=>{const s=d.find(l=>l.id===e);s?(I(s),N(e),p(!0)):c("Llanta no encontrada.")},b=e=>{const{name:s,value:l}=e.target;I({...o,[s]:l})},v=e=>{const{name:s,value:l}=e.target;F({...n,[s]:l})},Q=async()=>{if(!o.marca.trim()||!o.medida.trim()||!o.estado.trim()||!o.idMatricula.trim()){c("Todos los campos son obligatorios.");return}try{const e=await m.put(`http://localhost:4000/llantas/${i}`,o);C(d.map(s=>s.id===i?e.data:s)),p(!1)}catch(e){c("Error updating llantas: "+e.message)}},X=()=>{const e=document.getElementById("table-to-pdf");sa(e,{scale:2}).then(s=>{const l=s.toDataURL("image/png"),y=new la("p","mm","a4"),L=210,G=295,M=s.height*L/s.width;let E=M,R=0;for(y.addImage(l,"PNG",0,R,L,M),E-=G;E>=0;)R=E-M,y.addPage(),y.addImage(l,"PNG",0,R,L,M),E-=G;y.save("llantas.pdf")})},Y=e=>{W(e.target.value)},Z=d.filter(e=>e.marca.toLowerCase().includes(h.toLowerCase())||e.medida.toString().includes(h)||e.estado.toLowerCase().includes(h)||e.idMatricula.toString().includes(h));return a.jsxs(a.Fragment,{children:[a.jsx(ta,{children:a.jsx(oa,{xs:12,children:a.jsxs(na,{className:"mb-2",children:[a.jsxs(ia,{children:["Tabla Llantas",a.jsxs("div",{className:"d-flex justify-content-between",children:[a.jsxs("div",{className:"d-flex",children:[a.jsxs(r,{color:"primary",onClick:()=>g(!0),className:"me-2",children:[a.jsx(S,{icon:ca})," Añadir"]}),a.jsxs(r,{color:"danger",onClick:()=>f(!0),disabled:i===null,className:"me-2",children:[a.jsx(S,{icon:da})," Eliminar"]}),a.jsxs(r,{color:"info",onClick:()=>O(i),disabled:i===null,className:"me-2",children:[a.jsx(S,{icon:ha})," Editar"]}),a.jsxs(r,{color:"success",onClick:X,children:[a.jsx(S,{icon:ma})," Generar PDF"]})]}),a.jsx(j,{type:"text",placeholder:"Buscar",value:h,onChange:Y,className:"w-25"})]})]}),a.jsx(ra,{children:a.jsxs(_,{id:"table-to-pdf",align:"middle",className:"mb-0 border",hover:!0,responsive:!0,children:[a.jsx(aa,{className:"text-nowrap",children:a.jsxs(V,{children:[a.jsx(u,{className:"bg-body-tertiary",children:"#"}),a.jsx(u,{className:"bg-body-tertiary",children:"Marca"}),a.jsx(u,{className:"bg-body-tertiary",children:"Medida"}),a.jsx(u,{className:"bg-body-tertiary",children:"Estado"}),a.jsx(u,{className:"bg-body-tertiary",children:"Vehiculo"})]})}),a.jsx(ea,{children:Z.map((e,s)=>a.jsxs(V,{onClick:()=>N(e.id),className:e.id===i?"table-active":"","data-id":e.id,children:[a.jsx(x,{children:s+1}),a.jsx(x,{children:e.marca}),a.jsx(x,{children:e.medida}),a.jsx(x,{children:e.estado}),a.jsx(x,{children:e.idMatricula})]},e.id))})]})})]})})}),a.jsxs(T,{visible:q,onClose:()=>g(!1),children:[a.jsx(A,{children:a.jsx("h5",{children:"Añadir Llanta"})}),a.jsxs(D,{children:[a.jsx(j,{label:"Marca",name:"marca",value:n.marca,onChange:v}),a.jsx(j,{label:"Medida",name:"medida",value:n.memedidadia,onChange:v}),a.jsxs(w,{label:"Estado",name:"estado",value:n.estado,onChange:v,children:[a.jsx("option",{value:"",children:"Seleccionar Estado"}),a.jsx("option",{value:"Buena",children:"Buena"}),a.jsx("option",{value:"Regular",children:"Regular"}),a.jsx("option",{value:"Mala",children:"Mala"})]}),a.jsxs(w,{label:"Vehiculo",name:"idMatricula",value:n.idMatricula,onChange:v,children:[a.jsx("option",{value:0,children:"Selecciona la Matricula"}),B.map(e=>a.jsx("option",{value:e.id,children:e.matricula},e.id))]})]}),a.jsxs(k,{children:[a.jsx(r,{color:"secondary",onClick:()=>g(!1),children:"Cancelar"}),a.jsx(r,{color:"primary",onClick:J,children:"Añadir"})]})]}),a.jsxs(T,{visible:$,onClose:()=>p(!1),children:[a.jsx(A,{children:a.jsx("h5",{children:"Editar Llanta"})}),a.jsxs(D,{children:[a.jsx(j,{label:"Marca",name:"marca",value:o.marca||"",onChange:b}),a.jsx(j,{label:"Medida",name:"medida",value:o.medida||"",onChange:b}),a.jsxs(w,{label:"Estado",name:"estado",value:o.estado||"",onChange:b,children:[a.jsx("option",{value:"",children:"Seleccionar Estado"}),a.jsx("option",{value:"Buena",children:"Buena"}),a.jsx("option",{value:"Regular",children:"Regular"}),a.jsx("option",{value:"Mala",children:"Mala"})]}),a.jsxs(w,{label:"Vehiculo",name:"idMatricula",value:o.idMatricula||"",onChange:b,children:[a.jsx("option",{value:0,children:"Selecciona la Matricula"}),B.map(e=>a.jsx("option",{value:e.id,children:e.matricula},e.id))]})]}),a.jsxs(k,{children:[a.jsx(r,{color:"secondary",onClick:()=>p(!1),children:"Cancelar"}),a.jsx(r,{color:"primary",onClick:Q,children:"Guardar Cambios"})]})]}),a.jsxs(T,{visible:U,onClose:()=>f(!1),children:[a.jsx(A,{children:a.jsx("h5",{children:"Eliminar Llanta"})}),a.jsx(D,{children:"¿Estás seguro de que deseas eliminar esta llanta?"}),a.jsxs(k,{children:[a.jsx(r,{color:"secondary",onClick:()=>f(!1),children:"Cancelar"}),a.jsx(r,{color:"danger",onClick:K,children:"Eliminar"})]})]}),a.jsx("div",{className:"position-fixed bottom-0 start-0 p-3",style:{zIndex:1550},children:P.map((e,s)=>a.jsx(ua,{color:"danger",className:"mb-2",style:{zIndex:1560},children:e.message},s))})]})};export{Na as default};
