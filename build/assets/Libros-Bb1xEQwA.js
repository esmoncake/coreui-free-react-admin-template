import{r,j as e}from"./index-Cq3cNOe4.js";import{a as h}from"./axios-Bl1vbFzL.js";import{C as X,a as Y,b as P,c as m,d as Z,e as b,h as _,E as ee}from"./jspdf.es.min-DhbDYEgH.js";import{a as l,c as E}from"./index.esm-BVbxNr3O.js";import{C as ae,a as se}from"./CRow-CR1dTeP1.js";import{C as oe,a as re}from"./CCardBody-BZy5Kcki.js";import{C as le}from"./CCardHeader-Drjisk7v.js";import{c as ne,a as ie,b as te,d as ce}from"./cil-trash-BnkbpAXr.js";import{C as i}from"./CFormInput-CPK1Hc24.js";import{C as N,a as B,b as k,c as A}from"./CModalHeader-DM5zFOOe.js";import{C as H}from"./CFormSelect-sMFcUcNb.js";import"./DefaultLayout-VGzP6Txu.js";const we=()=>{const[d,x]=r.useState([]),[D,G]=r.useState([]),[n,y]=r.useState(null),[R,j]=r.useState(!1),[U,C]=r.useState(!1),[$,u]=r.useState(!1),[t,T]=r.useState({}),[c,I]=r.useState({nombre:"",editorial:"",ubicacion:0,isbn:""}),[M,q]=r.useState("");r.useEffect(()=>{const a=async()=>{try{const s=await h.get("http://localhost:4000/Libros");x(s.data)}catch(s){console.error("Error fetching Libros:",s)}},o=async()=>{try{const s=await h.get("http://localhost:4000/areas");G(s.data)}catch(s){console.error("Error fetching areas:",s)}};a(),o()},[]);const W=async()=>{try{const a=await h.post("http://localhost:4000/Libros",c);x([...d,a.data]),C(!1),I({nombre:"",editorial:"",ubicacion:0,isbn:""})}catch(a){console.error("Error adding book:",a)}},z=async()=>{try{await h.delete(`http://localhost:4000/Libros/${n}`);const a=d.filter(o=>o.id!==n);x(a),y(null),u(!1)}catch(a){console.error("Error deleting book:",a)}},J=a=>{const o=d.find(s=>s.id===a);T(o),y(a),j(!0)},p=a=>{const{name:o,value:s}=a.target;T({...t,[o]:s})},f=a=>{const{name:o,value:s}=a.target;I({...c,[o]:s})},K=async()=>{try{const a=await h.put(`http://localhost:4000/Libros/${n}`,t),o=d.map(s=>s.id===n?a.data:s);x(o),j(!1)}catch(a){console.error("Error updating book:",a)}},O=()=>{const a=document.getElementById("table-to-pdf");_(a,{scale:2}).then(o=>{const s=o.toDataURL("image/png"),g=new ee("p","mm","a4"),S=210,F=295,v=o.height*S/o.width;let w=v,L=0;for(g.addImage(s,"PNG",0,L,S,v),w-=F;w>=0;)L=w-v,g.addPage(),g.addImage(s,"PNG",0,L,S,v),w-=F;g.save("Libros.pdf")})},Q=a=>{q(a.target.value)},V=d.filter(a=>a.nombre.toLowerCase().includes(M.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx(ae,{children:e.jsx(se,{xs:12,children:e.jsxs(oe,{className:"mb-2",children:[e.jsxs(le,{children:["Tabla Libros",e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex",children:[e.jsxs(l,{color:"primary",onClick:()=>C(!0),className:"me-2",children:[e.jsx(E,{icon:ne})," Añadir"]}),e.jsxs(l,{color:"danger",onClick:()=>u(!0),disabled:n===null,className:"me-2",children:[e.jsx(E,{icon:ie})," Eliminar"]}),e.jsxs(l,{color:"info",onClick:()=>J(n),disabled:n===null,className:"me-2",children:[e.jsx(E,{icon:te})," Editar"]}),e.jsxs(l,{color:"success",onClick:O,children:[e.jsx(E,{icon:ce})," Generar PDF"]})]}),e.jsx(i,{type:"text",placeholder:"Buscar por nombre",value:M,onChange:Q,className:"w-25"})]})]}),e.jsx(re,{children:e.jsxs(X,{id:"table-to-pdf",align:"middle",className:"mb-0 border",hover:!0,responsive:!0,children:[e.jsx(Y,{className:"text-nowrap",children:e.jsxs(P,{children:[e.jsx(m,{children:"#"}),e.jsx(m,{children:"Nombre"}),e.jsx(m,{children:"Editorial"}),e.jsx(m,{children:"Ubicación"}),e.jsx(m,{children:"ISBN"})]})}),e.jsx(Z,{children:V.map((a,o)=>e.jsxs(P,{onClick:()=>y(a.id),className:a.id===n?"table-active":"",children:[e.jsx(b,{children:o+1})," ",e.jsx(b,{children:a.nombre}),e.jsx(b,{children:a.editorial}),e.jsx(b,{children:a.ubicacion}),e.jsx(b,{children:a.isbn})]},a.id))})]})})]})})}),e.jsxs(N,{visible:U,onClose:()=>C(!1),children:[e.jsx(B,{children:e.jsx("h5",{children:"Añadir Libro"})}),e.jsxs(k,{children:[e.jsx(i,{label:"Nombre",name:"nombre",value:c.nombre,onChange:f}),e.jsx(i,{label:"Editorial",name:"editorial",value:c.editorial,onChange:f}),e.jsxs(H,{label:"Ubicación",name:"ubicacion",value:c.ubicacion,onChange:f,children:[e.jsx("option",{value:"",children:"Seleccionar ubicación"}),D.map(a=>e.jsx("option",{value:a.idAreas,children:a.area},a.idAreas))]}),e.jsx(i,{label:"ISBN",name:"isbn",value:c.isbn,onChange:f})]}),e.jsxs(A,{children:[e.jsx(l,{color:"secondary",onClick:()=>C(!1),children:"Cerrar"}),e.jsx(l,{color:"primary",onClick:W,children:"Añadir Libro"})]})]}),e.jsxs(N,{visible:R,onClose:()=>j(!1),children:[e.jsx(B,{children:e.jsx("h5",{children:"Editar Libro"})}),e.jsxs(k,{children:[e.jsx(i,{label:"Nombre",name:"nombre",value:t.nombre,onChange:p}),e.jsx(i,{label:"Editorial",name:"editorial",value:t.editorial,onChange:p}),e.jsxs(H,{label:"Ubicación",name:"ubicacion",value:t.ubicacion,onChange:p,children:[e.jsx("option",{value:"",children:"Seleccionar ubicación"}),D.map(a=>e.jsx("option",{value:a.idAreas,children:a.area},a.idAreas))]}),e.jsx(i,{label:"ISBN",name:"isbn",value:t.isbn,onChange:p})]}),e.jsxs(A,{children:[e.jsx(l,{color:"secondary",onClick:()=>j(!1),children:"Cerrar"}),e.jsx(l,{color:"primary",onClick:K,children:"Guardar Cambios"})]})]}),e.jsxs(N,{visible:$,onClose:()=>u(!1),children:[e.jsx(B,{children:e.jsx("h5",{children:"Eliminar Libro"})}),e.jsx(k,{children:"¿Estás seguro de que deseas eliminar este libro?"}),e.jsxs(A,{children:[e.jsx(l,{color:"secondary",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(l,{color:"danger",onClick:z,children:"Eliminar"})]})]})]})};export{we as default};
