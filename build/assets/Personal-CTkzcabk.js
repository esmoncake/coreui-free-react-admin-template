import{r,j as e}from"./index-Cq3cNOe4.js";import{a as P}from"./axios-Bl1vbFzL.js";import{C as ee,a as ae,b as R,c as C,d as se,e as j,h as oe,E as ne}from"./jspdf.es.min-DhbDYEgH.js";import{a as l,c as A}from"./index.esm-BVbxNr3O.js";import{C as re,a as le}from"./CRow-CR1dTeP1.js";import{C as te,a as ce}from"./CCardBody-BZy5Kcki.js";import{C as ie}from"./CCardHeader-Drjisk7v.js";import{c as de,a as me,b as he,d as pe}from"./cil-trash-BnkbpAXr.js";import{C as t}from"./CFormInput-CPK1Hc24.js";import{C as D,a as T,b as k,c as L}from"./CModalHeader-DM5zFOOe.js";import{C as U}from"./CFormSelect-sMFcUcNb.js";import{C as ue}from"./CAlert-BYmA3n6A.js";import"./DefaultLayout-VGzP6Txu.js";const Se=()=>{const[b,v]=r.useState([]),[I,z]=r.useState([]),[h,S]=r.useState(null),[$,w]=r.useState(!1),[q,y]=r.useState(!1),[W,E]=r.useState(!1),[c,F]=r.useState({}),[i,H]=r.useState({nombre:"",apePaterno:"",apeMaterno:"",cumpleanos:"",ubicacion:0}),[B,G]=r.useState([]),[M,J]=r.useState("");r.useEffect(()=>{const a=async()=>{try{const o=await P.get("http://localhost:4000/personal");v(o.data)}catch{n("Error fetching personal")}},s=async()=>{try{const o=await P.get("http://localhost:4000/areas");z(o.data)}catch{n("Error fetching areas")}};a(),s()},[]);const n=a=>{G([...B,{message:a}]),setTimeout(()=>{G(s=>s.slice(1))},5e3)},K=async()=>{const{nombre:a,apePaterno:s,apeMaterno:o,cumpleanos:d,ubicacion:p}=i;if(!a.trim()){n("El nombre no puede estar vacío.");return}if(!s.trim()){n("El apellido paterno no puede estar vacío.");return}if(!o.trim()){n("El apellido materno no puede estar vacío.");return}if(!d.trim()){n("La fecha de cumpleaños no puede estar vacía.");return}if(p===0){n("Debe seleccionar una ubicación válida.");return}try{const m=await P.post("http://localhost:4000/personal",i);v([...b,m.data]),y(!1),H({nombre:"",apePaterno:"",apeMaterno:"",cumpleanos:"",ubicacion:0})}catch{n("Error adding personal")}},O=async()=>{const{nombre:a,apePaterno:s,apeMaterno:o,cumpleanos:d,ubicacion:p}=c;if(!a.trim()){n("El nombre no puede estar vacío.");return}if(!s.trim()){n("El apellido paterno no puede estar vacío.");return}if(!o.trim()){n("El apellido materno no puede estar vacío.");return}if(!d.trim()){n("La fecha de cumpleaños no puede estar vacía.");return}if(p===0){n("Debe seleccionar una ubicación válida.");return}try{const m=await P.put(`http://localhost:4000/personal/${h}`,c),x=b.map(u=>u.idPersonal===h?m.data:u);v(x),w(!1)}catch{n("Error updating personal")}},Q=async a=>{try{await P.delete(`http://localhost:4000/personal/${a}`);const s=b.filter(o=>o.idPersonal!==a);v(s),S(null),E(!1)}catch{n("Error deleting personal")}},V=a=>{const s=b.find(o=>o.idPersonal===a);F(s),S(a),w(!0)},f=a=>{const{name:s,value:o}=a.target;F({...c,[s]:o})},g=a=>{const{name:s,value:o}=a.target;H({...i,[s]:o})},X=()=>{const a=document.getElementById("table-to-pdf");oe(a,{scale:2}).then(s=>{const o=s.toDataURL("image/png"),d=new ne("p","mm","a4"),p=210,m=295,x=s.height*p/s.width;let u=x,N=0;for(d.addImage(o,"PNG",0,N,p,x),u-=m;u>=0;)N=u-x,d.addPage(),d.addImage(o,"PNG",0,N,p,x),u-=m;d.save("personal.pdf")})},Y=a=>{const s={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(a).toLocaleDateString(void 0,s)},Z=a=>{J(a.target.value)},_=b.filter(a=>a.nombre.toLowerCase().includes(M.toLowerCase())||a.apePaterno.toLowerCase().includes(M.toLowerCase())||a.apeMaterno.toLowerCase().includes(M.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx(re,{children:e.jsx(le,{xs:12,children:e.jsxs(te,{className:"mb-2",children:[e.jsxs(ie,{children:["Tabla de Capital Humano",e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex",children:[e.jsxs(l,{color:"primary",onClick:()=>y(!0),className:"me-2",children:[e.jsx(A,{icon:de})," Añadir"]}),e.jsxs(l,{color:"danger",onClick:()=>E(!0),disabled:h===null,className:"me-2",children:[e.jsx(A,{icon:me})," Eliminar"]}),e.jsxs(l,{color:"info",onClick:()=>V(h),disabled:h===null,className:"me-2",children:[e.jsx(A,{icon:he})," Editar"]}),e.jsxs(l,{color:"success",onClick:X,children:[e.jsx(A,{icon:pe})," Generar PDF"]})]}),e.jsx(t,{type:"text",placeholder:"Buscar por nombre",value:M,onChange:Z,className:"w-25"})]})]}),e.jsx(ce,{children:e.jsxs(ee,{id:"table-to-pdf",align:"middle",className:"mb-0 border",hover:!0,responsive:!0,children:[e.jsx(ae,{className:"text-nowrap",children:e.jsxs(R,{children:[e.jsx(C,{children:"#"}),e.jsx(C,{children:"Nombre"}),e.jsx(C,{children:"Apellido Paterno"}),e.jsx(C,{children:"Apellido Materno"}),e.jsx(C,{children:"Cumpleaños"}),e.jsx(C,{children:"Servicio en:"})]})}),e.jsx(se,{children:_.map(a=>e.jsxs(R,{onClick:()=>S(a.idPersonal),className:a.idPersonal===h?"table-active":"",children:[e.jsx(j,{children:a.idPersonal}),e.jsx(j,{children:a.nombre}),e.jsx(j,{children:a.apePaterno}),e.jsx(j,{children:a.apeMaterno}),e.jsx(j,{children:Y(a.cumpleanos)}),e.jsx(j,{children:a.ubicacion})]},a.idPersonal))})]})})]})})}),e.jsxs(D,{visible:q,onClose:()=>y(!1),children:[e.jsx(T,{children:e.jsx("h5",{children:"Añadir Personal"})}),e.jsxs(k,{children:[e.jsx(t,{label:"Nombre",name:"nombre",value:i.nombre,onChange:g}),e.jsx(t,{label:"Apellido Paterno",name:"apePaterno",value:i.apePaterno,onChange:g}),e.jsx(t,{label:"Apellido Materno",name:"apeMaterno",value:i.apeMaterno,onChange:g}),e.jsx(t,{label:"Cumpleaños",name:"cumpleanos",value:i.cumpleanos,onChange:g,type:"date"}),e.jsx(U,{label:"Ubicación",name:"ubicacion",value:i.ubicacion,onChange:g,children:I.map(a=>e.jsx("option",{value:a.idAreas,children:a.area},a.idAreas))})]}),e.jsxs(L,{children:[e.jsx(l,{color:"secondary",onClick:()=>y(!1),children:"Cancelar"}),e.jsx(l,{color:"primary",onClick:K,children:"Guardar"})]})]}),e.jsxs(D,{visible:$,onClose:()=>w(!1),children:[e.jsx(T,{children:e.jsx("h5",{children:"Editar Personal"})}),e.jsxs(k,{children:[e.jsx(t,{label:"Nombre",name:"nombre",value:c.nombre,onChange:f}),e.jsx(t,{label:"Apellido Paterno",name:"apePaterno",value:c.apePaterno,onChange:f}),e.jsx(t,{label:"Apellido Materno",name:"apeMaterno",value:c.apeMaterno,onChange:f}),e.jsx(t,{label:"Cumpleaños",name:"cumpleanos",value:c.cumpleanos,onChange:f,type:"date"}),e.jsx(U,{label:"Ubicación",name:"ubicacion",value:c.ubicacion,onChange:f,children:I.map(a=>e.jsx("option",{value:a.idAreas,children:a.area},a.idAreas))})]}),e.jsxs(L,{children:[e.jsx(l,{color:"secondary",onClick:()=>w(!1),children:"Cancelar"}),e.jsx(l,{color:"primary",onClick:O,children:"Guardar"})]})]}),e.jsxs(D,{visible:W,onClose:()=>E(!1),children:[e.jsx(T,{children:e.jsx("h5",{children:"Eliminar Personal"})}),e.jsx(k,{children:"¿Estás seguro de que deseas eliminar este personal?"}),e.jsxs(L,{children:[e.jsx(l,{color:"secondary",onClick:()=>E(!1),children:"Cancelar"}),e.jsx(l,{color:"danger",onClick:()=>Q(h),children:"Eliminar"})]})]}),e.jsx("div",{className:"position-fixed bottom-0 start-0 p-3",style:{zIndex:1550},children:B.map((a,s)=>e.jsx(ue,{color:"danger",className:"mb-2",style:{zIndex:1560},children:a.message},s))})]})};export{Se as default};
