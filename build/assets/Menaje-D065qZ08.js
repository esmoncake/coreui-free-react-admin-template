import{r as o,j as e}from"./index-Cq3cNOe4.js";import{a as h}from"./axios-Bl1vbFzL.js";import{C as _,a as ee,b as L,c as y,d as ae,e as v,h as se,E as ne}from"./jspdf.es.min-DhbDYEgH.js";import{a as t,c as T}from"./index.esm-BVbxNr3O.js";import{C as oe,a as te}from"./CRow-CR1dTeP1.js";import{C as ie,a as re}from"./CCardBody-BZy5Kcki.js";import{C as le}from"./CCardHeader-Drjisk7v.js";import{c as ce,a as de,b as he,d as me}from"./cil-trash-BnkbpAXr.js";import{C as N}from"./CFormInput-CPK1Hc24.js";import{C as A,a as D,b as k,c as R}from"./CModalHeader-DM5zFOOe.js";import{C as w}from"./CFormSelect-sMFcUcNb.js";import{C as je}from"./CAlert-BYmA3n6A.js";import"./DefaultLayout-VGzP6Txu.js";const Me=()=>{const[d,m]=o.useState([]),[F,U]=o.useState([]),[i,S]=o.useState(null),[V,j]=o.useState(!1),[$,p]=o.useState(!1),[q,x]=o.useState(!1),[r,P]=o.useState({}),[c,I]=o.useState({tipo:"",cantidad:"",ubicacion:""}),[u,W]=o.useState(""),[B,H]=o.useState([]);o.useEffect(()=>{const a=async()=>{try{const n=await h.get("http://localhost:4000/menaje");m(n.data)}catch(n){l("Error fetching menaje: "+n.message)}};(async()=>{try{const n=await h.get("http://localhost:4000/areas");U(n.data)}catch(n){console.error("Error fetching areas:",n)}})(),a()},[]);const l=a=>{H([...B,{message:a}]),setTimeout(()=>{H(s=>s.slice(1))},5e3)},J=async()=>{if(!c.tipo.trim()||!c.cantidad.trim()||!c.ubicacion.trim()){l("Todos los campos son obligatorios.");return}try{const a=await h.post("http://localhost:4000/menaje",c);m([...d,a.data]),p(!1),I({tipo:"",cantidad:"",ubicacion:""})}catch(a){l("Error adding menaje: "+a.message)}},K=async()=>{if(!i){l("No se ha seleccionado ningún menaje.");return}try{await h.delete(`http://localhost:4000/menaje/${i}`),m(d.filter(a=>a.id!==i)),S(null),x(!1)}catch(a){l("Error deleting menaje: "+a.message)}},O=a=>{const s=d.find(n=>n.id===a);s?(P(s),S(a),j(!0)):l("Menaje no encontrado.")},C=a=>{const{name:s,value:n}=a.target;P({...r,[s]:n})},G=a=>{const{name:s,value:n}=a.target;I({...c,[s]:n})},Q=async()=>{if(!r.tipo.trim()||!r.cantidad.trim()||!r.ubicacion.trim()){l("Todos los campos son obligatorios.");return}try{const a=await h.put(`http://localhost:4000/menaje/${i}`,r);m(d.map(s=>s.id===i?a.data:s)),j(!1)}catch(a){l("Error updating menaje: "+a.message)}},X=()=>{const a=document.getElementById("table-to-pdf");se(a,{scale:2}).then(s=>{const n=s.toDataURL("image/png"),b=new ne("p","mm","a4"),E=210,z=295,g=s.height*E/s.width;let f=g,M=0;for(b.addImage(n,"PNG",0,M,E,g),f-=z;f>=0;)M=f-g,b.addPage(),b.addImage(n,"PNG",0,M,E,g),f-=z;b.save("menaje.pdf")})},Y=a=>{W(a.target.value)},Z=d.filter(a=>a.tipo.toLowerCase().includes(u.toLowerCase())||a.cantidad.toString().includes(u)||a.ubicacion.toString().includes(u));return e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsx(te,{xs:12,children:e.jsxs(ie,{className:"mb-2",children:[e.jsxs(le,{children:["Tabla Menaje",e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex",children:[e.jsxs(t,{color:"primary",onClick:()=>p(!0),className:"me-2",children:[e.jsx(T,{icon:ce})," Añadir"]}),e.jsxs(t,{color:"danger",onClick:()=>x(!0),disabled:i===null,className:"me-2",children:[e.jsx(T,{icon:de})," Eliminar"]}),e.jsxs(t,{color:"info",onClick:()=>O(i),disabled:i===null,className:"me-2",children:[e.jsx(T,{icon:he})," Editar"]}),e.jsxs(t,{color:"success",onClick:X,children:[e.jsx(T,{icon:me})," Generar PDF"]})]}),e.jsx(N,{type:"text",placeholder:"Buscar por Tipo",value:u,onChange:Y,className:"w-25"})]})]}),e.jsx(re,{children:e.jsxs(_,{id:"table-to-pdf",align:"middle",className:"mb-0 border",hover:!0,responsive:!0,children:[e.jsx(ee,{className:"text-nowrap",children:e.jsxs(L,{children:[e.jsx(y,{className:"bg-body-tertiary",children:"#"}),e.jsx(y,{className:"bg-body-tertiary",children:"Tipo"}),e.jsx(y,{className:"bg-body-tertiary",children:"Cantidad"}),e.jsx(y,{className:"bg-body-tertiario",children:"Ubicación"})]})}),e.jsx(ae,{children:Z.map((a,s)=>e.jsxs(L,{onClick:()=>S(a.id),className:a.id===i?"table-active":"","data-id":a.id,children:[e.jsx(v,{children:s+1}),e.jsx(v,{children:a.tipo}),e.jsx(v,{children:a.cantidad}),e.jsx(v,{children:a.ubicacion})]},a.id))})]})})]})})}),e.jsxs(A,{visible:$,onClose:()=>p(!1),children:[e.jsx(D,{children:e.jsx("h5",{children:"Añadir Menaje"})}),e.jsxs(k,{children:[e.jsxs(w,{label:"Tipo",name:"tipo",value:c.tipo,onChange:G,children:[e.jsx("option",{value:"",children:"Seleccionar Tipo"}),e.jsx("option",{value:"Tazas",children:"Tazas"}),e.jsx("option",{value:"Termos",children:"Termos"}),e.jsx("option",{value:"Vasos",children:"Vasos"})]}),e.jsx(N,{label:"Cantidad",name:"cantidad",type:"number",value:c.cantidad,onChange:G}),e.jsx(w,{label:"Ubicación",name:"ubicacion",value:r.ubicacion,onChange:C,children:F.map(a=>e.jsx("option",{value:a.idAreas,children:a.area},a.idAreas))})]}),e.jsxs(R,{children:[e.jsx(t,{color:"secondary",onClick:()=>p(!1),children:"Cancelar"}),e.jsx(t,{color:"primary",onClick:J,children:"Añadir"})]})]}),e.jsxs(A,{visible:V,onClose:()=>j(!1),children:[e.jsx(D,{children:e.jsx("h5",{children:"Editar Menaje"})}),e.jsxs(k,{children:[e.jsxs(w,{label:"Tipo",name:"tipo",value:r.tipo||"",onChange:C,children:[e.jsx("option",{value:"",children:"Seleccionar Tipo"}),e.jsx("option",{value:"Tazas",children:"Tazas"}),e.jsx("option",{value:"Termos",children:"Termos"}),e.jsx("option",{value:"Vasos",children:"Vasos"})]}),e.jsx(N,{label:"Cantidad",name:"cantidad",type:"number",value:r.cantidad||"",onChange:C}),e.jsx(w,{label:"Ubicación",name:"ubicacion",value:r.ubicacion,onChange:C,children:F.map(a=>e.jsx("option",{value:a.idAreas,children:a.area},a.idAreas))})]}),e.jsxs(R,{children:[e.jsx(t,{color:"secondary",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(t,{color:"primary",onClick:Q,children:"Guardar Cambios"})]})]}),e.jsxs(A,{visible:q,onClose:()=>x(!1),children:[e.jsx(D,{children:e.jsx("h5",{children:"Eliminar Menaje"})}),e.jsx(k,{children:"¿Estás seguro de que deseas eliminar este menaje?"}),e.jsxs(R,{children:[e.jsx(t,{color:"secondary",onClick:()=>x(!1),children:"Cancelar"}),e.jsx(t,{color:"danger",onClick:K,children:"Eliminar"})]})]}),B.map((a,s)=>e.jsx(je,{color:"warning",children:a.message},s))]})};export{Me as default};
