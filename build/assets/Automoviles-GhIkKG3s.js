import{r as h,j as e}from"./index-Cq3cNOe4.js";import{a as v}from"./axios-Bl1vbFzL.js";import{C as oe,a as ne,b as V,c as t,d as se,e as r,h as le,E as ie}from"./jspdf.es.min-DhbDYEgH.js";import{a as u,c as T}from"./index.esm-BVbxNr3O.js";import{C as te,a as re}from"./CRow-CR1dTeP1.js";import{C as ce,a as de}from"./CCardBody-BZy5Kcki.js";import{C as he}from"./CCardHeader-Drjisk7v.js";import{c as me,a as ue,b as xe,d as je}from"./cil-trash-BnkbpAXr.js";import{C as n}from"./CFormInput-CPK1Hc24.js";import{C as pe}from"./CAlert-BYmA3n6A.js";import{C as L,a as R,b as w,c as k}from"./CModalHeader-DM5zFOOe.js";import{C}from"./CFormSelect-sMFcUcNb.js";import"./DefaultLayout-VGzP6Txu.js";const De=()=>{const[g,b]=h.useState([]),[B,q]=h.useState([]),[F,$]=h.useState([]),[x,N]=h.useState(null),[W,f]=h.useState(!1),[z,S]=h.useState(!1),[J,y]=h.useState(!1),[s,I]=h.useState({}),[l,H]=h.useState({matricula:"",tipo:"",marca:"",modelo:"",color:"",noMotor:"",servicio:"",idPersonal:0,observaciones:"",tenencia:"",seguro:"",verificacion:"",ubicacion:0,noSerie:""}),[i,K]=h.useState(""),[G,O]=h.useState([]);h.useEffect(()=>{(async()=>{try{const[o,m,p]=await Promise.all([v.get("http://localhost:4000/automoviles"),v.get("http://localhost:4000/personal"),v.get("http://localhost:4000/areas")]);b(o.data),q(m.data),$(p.data)}catch(o){j("Error fetching data: "+o.message)}})()},[]);const j=a=>{O([...G,{message:a}]),setTimeout(()=>{O(o=>o.slice(1))},5e3)},Q=async()=>{if(Object.values(l).some(a=>!a.toString().trim())){j("Todos los campos son obligatorios.");return}try{const a=await v.post("http://localhost:4000/automoviles",l);b([...g,a.data]),S(!1),H({matricula:"",tipo:"",marca:"",modelo:"",color:"",noMotor:"",servicio:"",idPersonal:0,observaciones:"",tenencia:"",seguro:"",verificacion:"",ubicacion:0,noSerie:""})}catch(a){j("Error adding automovil: "+a.message)}},X=async()=>{if(!x){j("No se ha seleccionado ningún automóvil.");return}try{await v.delete(`http://localhost:4000/automoviles/${x}`),b(g.filter(a=>a.id!==x)),N(null),y(!1)}catch(a){j("Error deleting automovil: "+a.message)}},Y=a=>{const o=g.find(m=>m.id===a);o?(I(o),N(a),f(!0)):j("Automóvil no encontrado.")},c=a=>{const{name:o,value:m}=a.target;I({...s,[o]:m})},d=a=>{const{name:o,value:m}=a.target;H({...l,[o]:m})},Z=async()=>{if(Object.values(s).some(a=>!a.toString().trim())){j("Todos los campos son obligatorios.");return}try{const a=await v.put(`http://localhost:4000/automoviles/${x}`,s);b(g.map(o=>o.id===x?a.data:o)),f(!1)}catch(a){j("Error updating automovil: "+a.message)}},_=()=>{const a=document.getElementById("table-to-pdf");le(a,{scale:2}).then(o=>{const m=o.toDataURL("image/png"),p=new ie("p","mm","a4"),E=210,U=295,A=o.height*E/o.width;let P=A,D=0;for(p.addImage(m,"PNG",0,D,E,A),P-=U;P>=0;)D=P-A,p.addPage(),p.addImage(m,"PNG",0,D,E,A),P-=U;p.save("automovil.pdf")})},ee=a=>{K(a.target.value)},ae=g.filter(a=>a.matricula.toString().includes(i)||a.tipo.toLowerCase().includes(i.toLowerCase())||a.marca.toLowerCase().includes(i.toLowerCase())||a.modelo.toLowerCase().includes(i.toLowerCase())||a.color.toLowerCase().includes(i.toLowerCase())||a.noMotor.toString().includes(i)||a.servicio.toString().includes(i)||a.personal.toString().includes(i)||a.observaciones.toLowerCase().includes(i.toLowerCase())||a.tenencia.toString().includes(i)||a.seguro.toString().includes(i)||a.verificacion.toString().includes(i)||a.ubicacion.toString().includes(i)||a.noSerie.toLowerCase().includes(i.toLowerCase())),M=a=>{if(!a)return"";const o={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(a).toLocaleDateString(void 0,o)};return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsx(re,{xs:12,children:e.jsxs(ce,{className:"mb-2",children:[e.jsxs(he,{children:["Tabla Automóviles",e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex",children:[e.jsxs(u,{color:"primary",onClick:()=>S(!0),className:"me-2",children:[e.jsx(T,{icon:me})," Añadir"]}),e.jsxs(u,{color:"danger",onClick:()=>y(!0),disabled:x===null,className:"me-2",children:[e.jsx(T,{icon:ue})," Eliminar"]}),e.jsxs(u,{color:"info",onClick:()=>Y(x),disabled:x===null,className:"me-2",children:[e.jsx(T,{icon:xe})," Editar"]}),e.jsxs(u,{color:"success",onClick:_,children:[e.jsx(T,{icon:je})," Generar PDF"]})]}),e.jsx(n,{type:"text",placeholder:"Buscar",value:i,onChange:ee,className:"w-25"})]})]}),e.jsx(de,{children:e.jsxs(oe,{id:"table-to-pdf",align:"middle",className:"mb-0 border",hover:!0,responsive:!0,children:[e.jsx(ne,{className:"text-nowrap",children:e.jsxs(V,{children:[e.jsx(t,{children:"#"}),e.jsx(t,{children:"Matricula"}),e.jsx(t,{children:"Tipo"}),e.jsx(t,{children:"Marca"}),e.jsx(t,{children:"Modelo"}),e.jsx(t,{children:"Color"}),e.jsx(t,{children:"No. Motor"}),e.jsx(t,{children:"Prox-Mantenimiento"}),e.jsx(t,{children:"Resguardo"}),e.jsx(t,{children:"Observaciones"}),e.jsx(t,{children:"Tenencia"}),e.jsx(t,{children:"Seguro"}),e.jsx(t,{children:"Verificación"}),e.jsx(t,{children:"Ubicación"}),e.jsx(t,{children:"No. Serie"})]})}),e.jsx(se,{children:ae.map((a,o)=>e.jsxs(V,{active:x===a.id,onClick:()=>N(a.id),children:[e.jsx(r,{children:o+1}),e.jsx(r,{children:a.matricula}),e.jsx(r,{children:a.tipo}),e.jsx(r,{children:a.marca}),e.jsx(r,{children:a.modelo}),e.jsx(r,{children:a.color}),e.jsx(r,{children:a.noMotor}),e.jsx(r,{children:M(a.servicio)}),e.jsx(r,{children:a.personal}),e.jsx(r,{children:a.observaciones}),e.jsx(r,{children:M(a.tenencia)}),e.jsx(r,{children:M(a.seguro)}),e.jsx(r,{children:M(a.verificacion)}),e.jsx(r,{children:a.ubicacion}),e.jsx(r,{children:a.noSerie})]},a.id))})]})})]})})}),G.map((a,o)=>e.jsx(pe,{color:"danger",className:"d-inline-block w-auto",children:a.message},o)),e.jsxs(L,{visible:z,onClose:()=>S(!1),children:[e.jsx(R,{children:"Agregar Automóvil"}),e.jsxs(w,{children:[e.jsx(n,{type:"text",name:"matricula",label:"Matricula",value:l.matricula,onChange:d}),e.jsxs(C,{label:"Tipo",name:"tipo",value:l.tipo,onChange:d,children:[e.jsx("option",{value:"",children:"Seleccionar Tipo"}),e.jsx("option",{value:"Auto",children:"Auto"}),e.jsx("option",{value:"Camioneta",children:"Camioneta"}),e.jsx("option",{value:"Moto",children:"Moto"}),e.jsx("option",{value:"Scooter",children:"Scooter"}),e.jsx("option",{value:"Bicicletas",children:"Bicicletas"})]}),e.jsx(n,{type:"text",name:"marca",label:"Marca",value:l.marca,onChange:d}),e.jsx(n,{type:"text",name:"modelo",label:"Modelo",value:l.modelo,onChange:d}),e.jsx(n,{type:"text",name:"color",label:"Color",value:l.color,onChange:d}),e.jsx(n,{type:"text",name:"noMotor",label:"No. Motor",value:l.noMotor,onChange:d}),e.jsx(n,{type:"date",name:"servicio",label:"Servicio",value:l.servicio,onChange:d}),e.jsxs(C,{name:"idPersonal",label:"Personal",value:l.idPersonal,onChange:d,children:[e.jsx("option",{value:0,children:"Selecciona Personal"}),B.map(a=>e.jsx("option",{value:a.idPersonal,children:a.nombre},a.idPersonal))]}),e.jsx(n,{type:"text",name:"observaciones",label:"Observaciones",value:l.observaciones,onChange:d}),e.jsx(n,{type:"date",name:"tenencia",label:"Tenencia",value:l.tenencia,onChange:d}),e.jsx(n,{type:"date",name:"seguro",label:"Seguro",value:l.seguro,onChange:d}),e.jsx(n,{type:"date",name:"verificacion",label:"Verificación",value:l.verificacion,onChange:d}),e.jsxs(C,{label:"Ubicación",name:"ubicacion",value:l.ubicacion||"",onChange:d,children:[e.jsx("option",{value:"",children:"Seleccionar"}),F.map(a=>e.jsx("option",{value:a.idAreas,children:a.area},a.idAreas))]}),e.jsx(n,{type:"text",name:"noSerie",label:"No. Serie",value:l.noSerie,onChange:d})]}),e.jsxs(k,{children:[e.jsx(u,{color:"primary",onClick:Q,children:"Añadir"}),e.jsx(u,{color:"secondary",onClick:()=>S(!1),children:"Cancelar"})]})]}),e.jsxs(L,{visible:W,onClose:()=>f(!1),children:[e.jsx(R,{children:"Editar Automóvil"}),e.jsxs(w,{children:[e.jsx(n,{type:"text",name:"matricula",label:"Matricula",value:s.matricula||"",onChange:c}),e.jsxs(C,{label:"Tipo",name:"tipo",value:s.tipo,onChange:c,children:[e.jsx("option",{value:"",children:"Seleccionar Tipo"}),e.jsx("option",{value:"Auto",children:"Auto"}),e.jsx("option",{value:"Camioneta",children:"Camioneta"}),e.jsx("option",{value:"Moto",children:"Moto"}),e.jsx("option",{value:"Scooter",children:"Scooter"}),e.jsx("option",{value:"Bicicletas",children:"Bicicletas"})]}),e.jsx(n,{type:"text",name:"marca",label:"Marca",value:s.marca||"",onChange:c}),e.jsx(n,{type:"text",name:"modelo",label:"Modelo",value:s.modelo||"",onChange:c}),e.jsx(n,{type:"text",name:"color",label:"Color",value:s.color||"",onChange:c}),e.jsx(n,{type:"text",name:"noMotor",label:"No. Motor",value:s.noMotor||"",onChange:c}),e.jsx(n,{type:"date",name:"servicio",label:"Servicio",value:s.servicio||"",onChange:c}),e.jsxs(C,{name:"idPersonal",label:"Personal",value:s.idPersonal||"",onChange:c,children:[e.jsx("option",{value:0,children:"Selecciona Personal"}),B.map(a=>e.jsx("option",{value:a.idPersonal,children:a.nombre},a.idPersonal))]}),e.jsx(n,{type:"text",name:"observaciones",label:"Observaciones",value:s.observaciones||"",onChange:c}),e.jsx(n,{type:"date",name:"tenencia",label:"Tenencia",value:s.tenencia||"",onChange:c}),e.jsx(n,{type:"date",name:"seguro",label:"Seguro",value:s.seguro||"",onChange:c}),e.jsx(n,{type:"date",name:"verificacion",label:"Verificación",value:s.verificacion||"",onChange:c}),e.jsxs(C,{label:"Ubicación",name:"ubicacion",value:s.ubicacion||"",onChange:c,children:[e.jsx("option",{value:"",children:"Seleccionar"}),F.map(a=>e.jsx("option",{value:a.idAreas,children:a.area},a.idAreas))]}),e.jsx(n,{type:"text",name:"noSerie",label:"No. Serie",value:s.noSerie||"",onChange:c})]}),e.jsxs(k,{children:[e.jsx(u,{color:"primary",onClick:Z,children:"Guardar cambios"}),e.jsx(u,{color:"secondary",onClick:()=>f(!1),children:"Cancelar"})]})]}),e.jsxs(L,{visible:J,onClose:()=>y(!1),children:[e.jsx(R,{children:"Eliminar Automóvil"}),e.jsx(w,{children:"¿Estás seguro de que quieres eliminar este automóvil?"}),e.jsxs(k,{children:[e.jsx(u,{color:"danger",onClick:X,children:"Eliminar"}),e.jsx(u,{color:"secondary",onClick:()=>y(!1),children:"Cancelar"})]})]})]})};export{De as default};
