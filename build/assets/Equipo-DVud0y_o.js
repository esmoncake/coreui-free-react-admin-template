import{r,j as e}from"./index-Cq3cNOe4.js";import{a as h}from"./axios-Bl1vbFzL.js";import{C as ee,a as ae,b as H,c as b,d as oe,e as v,h as se,E as re}from"./jspdf.es.min-DhbDYEgH.js";import{a as t,c as E}from"./index.esm-BVbxNr3O.js";import{C as te,a as ne}from"./CRow-CR1dTeP1.js";import{C as ie,a as le}from"./CCardBody-BZy5Kcki.js";import{C as ce}from"./CCardHeader-Drjisk7v.js";import{c as de,a as he,b as pe,d as me}from"./cil-trash-BnkbpAXr.js";import{C as N}from"./CFormInput-CPK1Hc24.js";import{C as D,a as F,b as A,c as k}from"./CModalHeader-DM5zFOOe.js";import{C as P}from"./CFormSelect-sMFcUcNb.js";import{C as ue}from"./CAlert-BYmA3n6A.js";import"./DefaultLayout-VGzP6Txu.js";const qe=()=>{const[d,p]=r.useState([]),[R,$]=r.useState([]),[n,y]=r.useState(null),[U,m]=r.useState(!1),[W,u]=r.useState(!1),[z,x]=r.useState(!1),[i,M]=r.useState({}),[l,G]=r.useState({tipo:"",idPersonal:"",fechaEntrega:""}),[j,J]=r.useState(""),[I,L]=r.useState([]);r.useEffect(()=>{const a=async()=>{try{const s=await h.get("http://localhost:4000/equipo");p(s.data)}catch(s){c("Error fetching equipo: "+s.message)}};(async()=>{try{const s=await h.get("http://localhost:4000/personal");$(s.data)}catch(s){console.error("Error obtniendo personal:",s)}})(),a()},[]);const c=a=>{L([...I,{message:a}]),setTimeout(()=>{L(o=>o.slice(1))},5e3)},K=async()=>{if(!l.tipo.trim()||!l.idPersonal.trim()||!l.fechaEntrega.trim()){c("Todos los campos son obligatorios.");return}try{const a=await h.post("http://localhost:4000/equipo",l);p([...d,a.data]),u(!1),G({tipo:"",idPersonal:"",fechaEntrega:""})}catch(a){c("Error adding equipo: "+a.message)}},O=async()=>{if(!n){c("No se ha seleccionado ningún equipo.");return}try{await h.delete(`http://localhost:4000/equipo/${n}`),p(d.filter(a=>a.id!==n)),y(null),x(!1)}catch(a){c("Error deleting equipo: "+a.message)}},Q=a=>{const o=d.find(s=>s.id===a);o?(M(o),y(a),m(!0)):c("Equipo no encontrado.")},S=a=>{const{name:o,value:s}=a.target;M({...i,[o]:s})},w=a=>{const{name:o,value:s}=a.target;G({...l,[o]:s})},V=async()=>{if(!i.tipo.trim()||!i.idPersonal.trim()||!i.fechaEntrega.trim()){c("Todos los campos son obligatorios.");return}try{const a=await h.put(`http://localhost:4000/equipo/${n}`,i);p(d.map(o=>o.id===n?a.data:o)),m(!1)}catch(a){c("Error updating equipo: "+a.message)}},X=()=>{const a=document.getElementById("table-to-pdf");se(a,{scale:2}).then(o=>{const s=o.toDataURL("image/png"),g=new re("p","mm","a4"),T=210,B=295,C=o.height*T/o.width;let f=C,q=0;for(g.addImage(s,"PNG",0,q,T,C),f-=B;f>=0;)q=f-C,g.addPage(),g.addImage(s,"PNG",0,q,T,C),f-=B;g.save("equipo.pdf")})},Y=a=>{J(a.target.value)},Z=d.filter(a=>a.tipo.toLowerCase().includes(j.toLowerCase())||a.fechaEntrega.toString().includes(j)||a.personal.toString().includes(j)),_=a=>{const o={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(a).toLocaleDateString(void 0,o)};return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsx(ne,{xs:12,children:e.jsxs(ie,{className:"mb-2",children:[e.jsxs(ce,{children:["Tabla Equipamiento",e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex",children:[e.jsxs(t,{color:"primary",onClick:()=>u(!0),className:"me-2",children:[e.jsx(E,{icon:de})," Añadir"]}),e.jsxs(t,{color:"danger",onClick:()=>x(!0),disabled:n===null,className:"me-2",children:[e.jsx(E,{icon:he})," Eliminar"]}),e.jsxs(t,{color:"info",onClick:()=>Q(n),disabled:n===null,className:"me-2",children:[e.jsx(E,{icon:pe})," Editar"]}),e.jsxs(t,{color:"success",onClick:X,children:[e.jsx(E,{icon:me})," Generar PDF"]})]}),e.jsx(N,{type:"text",placeholder:"Buscar por Tipo",value:j,onChange:Y,className:"w-25"})]})]}),e.jsx(le,{children:e.jsxs(ee,{id:"table-to-pdf",align:"middle",className:"mb-0 border",hover:!0,responsive:!0,children:[e.jsx(ae,{className:"text-nowrap",children:e.jsxs(H,{children:[e.jsx(b,{className:"bg-body-tertiary",children:"#"}),e.jsx(b,{className:"bg-body-tertiary",children:"Tipo"}),e.jsx(b,{className:"bg-body-tertiary",children:"Personal"}),e.jsx(b,{className:"bg-body-terciario",children:"Fecha Entrega"})]})}),e.jsx(oe,{children:Z.map((a,o)=>e.jsxs(H,{onClick:()=>y(a.id),className:a.id===n?"table-active":"","data-id":a.id,children:[e.jsx(v,{children:o+1}),e.jsx(v,{children:a.tipo}),e.jsx(v,{children:a.personal}),e.jsx(v,{children:_(a.fechaEntrega)})]},a.id))})]})})]})})}),e.jsxs(D,{visible:W,onClose:()=>u(!1),children:[e.jsx(F,{children:e.jsx("h5",{children:"Añadir Equipo"})}),e.jsxs(A,{children:[e.jsxs(P,{label:"Tipo",name:"tipo",value:l.tipo,onChange:w,children:[e.jsx("option",{value:"",children:"Seleccionar Tipo"}),e.jsx("option",{value:"Pr24",children:"Pr24"}),e.jsx("option",{value:"Silbato",children:"Silbato"}),e.jsx("option",{value:"Linterna",children:"Linterna"}),e.jsx("option",{value:"Porta linterna",children:"Porta linterna"}),e.jsx("option",{value:"Porta radio",children:"Porta radio"}),e.jsx("option",{value:"Tarjetero",children:"Tarjetero"}),e.jsx("option",{value:"Arillo",children:"Arillo"}),e.jsx("option",{value:"Gas pimienta",children:"Gas pimienta"}),e.jsx("option",{value:"Fornitura",children:"Fornitura"})]}),e.jsxs(P,{label:"ID Personal",name:"idPersonal",value:l.idPersonal,onChange:w,children:[e.jsx("option",{value:"",children:"Seleccionar Personal"}),R.map(a=>e.jsx("option",{value:a.idPersonal,children:a.nombre},a.idPersonal))]}),e.jsx(N,{label:"Fecha Entrega",name:"fechaEntrega",type:"date",value:l.fechaEntrega,onChange:w})]}),e.jsxs(k,{children:[e.jsx(t,{color:"secondary",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(t,{color:"primary",onClick:K,children:"Añadir"})]})]}),e.jsxs(D,{visible:U,onClose:()=>m(!1),children:[e.jsx(F,{children:e.jsx("h5",{children:"Editar Equipo"})}),e.jsxs(A,{children:[e.jsxs(P,{label:"Tipo",name:"tipo",value:i.tipo||"",onChange:S,children:[e.jsx("option",{value:"",children:"Seleccionar Tipo"}),e.jsx("option",{value:"Pr24",children:"Pr24"}),e.jsx("option",{value:"Silbato",children:"Silbato"}),e.jsx("option",{value:"Linterna",children:"Linterna"}),e.jsx("option",{value:"Porta linterna",children:"Porta linterna"}),e.jsx("option",{value:"Porta radio",children:"Porta radio"}),e.jsx("option",{value:"Tarjetero",children:"Tarjetero"}),e.jsx("option",{value:"Arillo",children:"Arillo"}),e.jsx("option",{value:"Gas pimienta",children:"Gas pimienta"}),e.jsx("option",{value:"Fornitura",children:"Fornitura"})]}),e.jsxs(P,{label:"ID Personal",name:"idPersonal",value:i.idPersonal||"",onChange:S,children:[e.jsx("option",{value:"",children:"Seleccionar Personal"}),R.map(a=>e.jsx("option",{value:a.idPersonal,children:a.nombre},a.idPersonal))]}),e.jsx(N,{label:"Fecha Entrega",name:"fechaEntrega",type:"date",value:i.fechaEntrega||"",onChange:S})]}),e.jsxs(k,{children:[e.jsx(t,{color:"secondary",onClick:()=>m(!1),children:"Cancelar"}),e.jsx(t,{color:"primary",onClick:V,children:"Guardar Cambios"})]})]}),e.jsxs(D,{visible:z,onClose:()=>x(!1),children:[e.jsx(F,{children:e.jsx("h5",{children:"Eliminar Equipo"})}),e.jsx(A,{children:"¿Estás seguro de que deseas eliminar este equipo?"}),e.jsxs(k,{children:[e.jsx(t,{color:"secondary",onClick:()=>x(!1),children:"Cancelar"}),e.jsx(t,{color:"danger",onClick:O,children:"Eliminar"})]})]}),I.map((a,o)=>e.jsx(ue,{color:"warning",children:a.message},o))]})};export{qe as default};
