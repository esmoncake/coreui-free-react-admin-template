import{r as n,j as e}from"./index-Cq3cNOe4.js";import{a as C}from"./axios-Bl1vbFzL.js";import{C as oe,a as se,b as q,c as m,d as re,e as p,h as le,E as ne}from"./jspdf.es.min-DhbDYEgH.js";import{a as i,c as w}from"./index.esm-BVbxNr3O.js";import{C as te,a as ie}from"./CRow-CR1dTeP1.js";import{C as ce,a as de}from"./CCardBody-BZy5Kcki.js";import{C as he}from"./CCardHeader-Drjisk7v.js";import{c as me,a as pe,b as ue,d as xe}from"./cil-trash-BnkbpAXr.js";import{C as d}from"./CFormInput-CPK1Hc24.js";import{C as R,a as k,b as D,c as F}from"./CModalHeader-DM5zFOOe.js";import{C as j}from"./CFormSelect-sMFcUcNb.js";import{C as Ce}from"./CAlert-BYmA3n6A.js";import"./DefaultLayout-VGzP6Txu.js";const Ae=()=>{const[g,b]=n.useState([]),[L,$]=n.useState([]),[I,W]=n.useState([]),[c,P]=n.useState(null),[z,f]=n.useState(!1),[J,v]=n.useState(!1),[K,S]=n.useState(!1),[r,B]=n.useState({}),[l,H]=n.useState({tipo:"",marca:"",modelo:"",noSerie:"",capacidad:"",area:0,resguardo:0}),[y,O]=n.useState(""),[T,G]=n.useState([]);n.useEffect(()=>{const a=async()=>{try{const s=await C.get("http://localhost:4000/computo");b(s.data)}catch(s){h("Error fetching computo: "+s.message)}},o=async()=>{try{const s=await C.get("http://localhost:4000/personal");$(s.data)}catch(s){console.error("Error obteniendo personal:",s)}},t=async()=>{try{const s=await C.get("http://localhost:4000/areas");W(s.data)}catch(s){console.error("Error obteniendo áreas:",s)}};o(),a(),t()},[]);const h=a=>{G([...T,{message:a}]),setTimeout(()=>{G(o=>o.slice(1))},5e3)},Q=async()=>{if(!l.tipo.trim()||!l.resguardo.trim()||!l.area.trim()){h("Todos los campos son obligatorios.");return}try{const a=await C.post("http://localhost:4000/computo",l);b([...g,a.data]),v(!1),H({tipo:"",marca:"",modelo:"",noSerie:"",capacidad:"",area:0,resguardo:0})}catch(a){h("Error adding computo: "+a.message)}},V=async()=>{if(!c){h("No se ha seleccionado ningún computo.");return}try{await C.delete(`http://localhost:4000/computo/${c}`),b(g.filter(a=>a.id!==c)),P(null),S(!1)}catch(a){h("Error deleting computo: "+a.message)}},X=a=>{const o=g.find(t=>t.id===a);o?(B(o),P(a),f(!0)):h("Computo no encontrado.")},u=a=>{const{name:o,value:t}=a.target;B({...r,[o]:t})},x=a=>{const{name:o,value:t}=a.target;H({...l,[o]:t})},Y=async()=>{if(!r.tipo.trim()||!r.resguardo.trim()||!r.area.trim()){h("Todos los campos son obligatorios.");return}try{const a=await C.put(`http://localhost:4000/computo/${c}`,r);b(g.map(o=>o.id===c?a.data:o)),f(!1)}catch(a){h("Error updating computo: "+a.message)}},Z=()=>{const a=document.getElementById("table-to-pdf");le(a,{scale:2}).then(o=>{const t=o.toDataURL("image/png"),s=new ne("p","mm","a4"),M=210,U=295,N=o.height*M/o.width;let E=N,A=0;for(s.addImage(t,"PNG",0,A,M,N),E-=U;E>=0;)A=E-N,s.addPage(),s.addImage(t,"PNG",0,A,M,N),E-=U;s.save("computo.pdf")})},_=a=>{O(a.target.value)},ee=a=>{P(a)},ae=g.filter(a=>a.tipo.toLowerCase().includes(y.toLowerCase())||a.fechaEntrega.toString().includes(y)||a.idPersonal.toString().includes(y));return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsx(ie,{xs:12,children:e.jsxs(ce,{className:"mb-2",children:[e.jsxs(he,{children:["Tabla Equipos Computo",e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex",children:[e.jsxs(i,{color:"primary",onClick:()=>v(!0),className:"me-2",children:[e.jsx(w,{icon:me})," Añadir"]}),e.jsxs(i,{color:"danger",onClick:()=>S(!0),disabled:c===null,className:"me-2",children:[e.jsx(w,{icon:pe})," Eliminar"]}),e.jsxs(i,{color:"info",onClick:()=>X(c),disabled:c===null,className:"me-2",children:[e.jsx(w,{icon:ue})," Editar"]}),e.jsxs(i,{color:"success",onClick:Z,children:[e.jsx(w,{icon:xe})," Generar PDF"]})]}),e.jsx(d,{type:"text",placeholder:"Buscar por Tipo",value:y,onChange:_,className:"w-25"})]})]}),e.jsx(de,{children:e.jsxs(oe,{id:"table-to-pdf",align:"middle",className:"mb-0 border",hover:!0,responsive:!0,children:[e.jsx(se,{className:"text-nowrap",children:e.jsxs(q,{children:[e.jsx(m,{className:"bg-body-terciario",children:"#"}),e.jsx(m,{className:"bg-body-terciario",children:"Tipo"}),e.jsx(m,{className:"bg-body-terciario",children:"Marca"}),e.jsx(m,{className:"bg-body-terciario",children:"Modelo"}),e.jsx(m,{className:"bg-body-terciario",children:"No. Serie"}),e.jsx(m,{className:"bg-body-terciario",children:"Capacidad"}),e.jsx(m,{className:"bg-body-terciario",children:"Área"}),e.jsx(m,{className:"bg-body-terciario",children:"Resguardo"})]})}),e.jsx(re,{children:ae.map((a,o)=>e.jsxs(q,{onClick:()=>ee(a.id),className:a.id===c?"bg-light":"",children:[e.jsx(p,{children:o+1})," ",e.jsx(p,{children:a.tipo}),e.jsx(p,{children:a.marca}),e.jsx(p,{children:a.modelo}),e.jsx(p,{children:a.noSerie}),e.jsx(p,{children:a.capacidad}),e.jsx(p,{children:a.area}),e.jsx(p,{children:a.resguardo})]},a.id))})]})})]})})}),e.jsxs(R,{visible:J,onClose:()=>v(!1),children:[e.jsx(k,{children:e.jsx("h5",{children:"Añadir Computo"})}),e.jsxs(D,{children:[e.jsxs(j,{label:"Tipo",name:"tipo",value:l.tipo,onChange:x,children:[e.jsx("option",{value:"",children:"Seleccionar Tipo"}),e.jsx("option",{value:"Computadora",children:"Computadora"}),e.jsx("option",{value:"Laptop",children:"Laptop"}),e.jsx("option",{value:"CPU",children:"CPU"})]}),e.jsx(d,{label:"Marca",name:"marca",value:l.marca,onChange:x}),e.jsx(d,{label:"Modelo",name:"modelo",value:l.modelo,onChange:x}),e.jsx(d,{label:"No. Serie",name:"noSerie",value:l.noSerie,onChange:x}),e.jsx(d,{label:"Capacidad",name:"capacidad",value:l.capacidad,onChange:x}),e.jsxs(j,{label:"Área",name:"area",value:l.area,onChange:x,children:[e.jsx("option",{value:0,children:"Selecciona una ubicación"}),I.map(a=>e.jsx("option",{value:a.idAreas,children:a.area},a.idAreas))]}),e.jsxs(j,{label:"Resguardo",name:"resguardo",value:l.resguardo,onChange:x,children:[e.jsx("option",{value:"",children:"Seleccionar Personal"}),L.map(a=>e.jsx("option",{value:a.idPersonal,children:a.nombre},a.idPersonal))]})]}),e.jsxs(F,{children:[e.jsx(i,{color:"secondary",onClick:()=>v(!1),children:"Cancelar"}),e.jsx(i,{color:"primary",onClick:Q,children:"Añadir"})]})]}),e.jsxs(R,{visible:z,onClose:()=>f(!1),children:[e.jsx(k,{children:e.jsx("h5",{children:"Editar Computo"})}),e.jsxs(D,{children:[e.jsxs(j,{label:"Tipo",name:"tipo",value:r.tipo||"",onChange:u,children:[e.jsx("option",{value:"",children:"Seleccionar Tipo"}),e.jsx("option",{value:"Computadora",children:"Computadora"}),e.jsx("option",{value:"Laptop",children:"Laptop"}),e.jsx("option",{value:"CPU",children:"CPU"})]}),e.jsx(d,{label:"Marca",name:"marca",value:r.marca||"",onChange:u}),e.jsx(d,{label:"Modelo",name:"modelo",value:r.modelo||"",onChange:u}),e.jsx(d,{label:"No. Serie",name:"noSerie",value:r.noSerie||"",onChange:u}),e.jsx(d,{label:"Capacidad",name:"capacidad",value:r.capacidad||"",onChange:u}),e.jsxs(j,{label:"Área",name:"area",value:r.area,onChange:u,children:[e.jsx("option",{value:0,children:"Selecciona una ubicación"}),I.map(a=>e.jsx("option",{value:a.idAreas,children:a.area},a.idAreas))]}),e.jsxs(j,{label:"Resguardo",name:"resguardo",value:r.resguardo,onChange:u,children:[e.jsx("option",{value:"",children:"Seleccionar Personal"}),L.map(a=>e.jsx("option",{value:a.idPersonal,children:a.nombre},a.idPersonal))]})]}),e.jsxs(F,{children:[e.jsx(i,{color:"secondary",onClick:()=>f(!1),children:"Cancelar"}),e.jsx(i,{color:"primary",onClick:Y,children:"Guardar Cambios"})]})]}),e.jsxs(R,{visible:K,onClose:()=>S(!1),children:[e.jsx(k,{children:e.jsx("h5",{children:"Eliminar Computo"})}),e.jsx(D,{children:"¿Estás seguro de que deseas eliminar este computo?"}),e.jsxs(F,{children:[e.jsx(i,{color:"secondary",onClick:()=>S(!1),children:"Cancelar"}),e.jsx(i,{color:"danger",onClick:V,children:"Eliminar"})]})]}),T.length>0&&T.map((a,o)=>e.jsx(Ce,{color:"danger",children:a.message},o))]})};export{Ae as default};
