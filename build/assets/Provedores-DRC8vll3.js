import{r as n,j as e}from"./index-Cq3cNOe4.js";import{a as y}from"./axios-Bl1vbFzL.js";import{C as X,a as Y,b as H,c as N,d as Z,e as P,h as _,E as ee}from"./jspdf.es.min-DhbDYEgH.js";import{a as l,c as E}from"./index.esm-BVbxNr3O.js";import{C as re,a as oe}from"./CRow-CR1dTeP1.js";import{C as se,a as ae}from"./CCardBody-BZy5Kcki.js";import{C as te}from"./CCardHeader-Drjisk7v.js";import{c as ne,a as le,b as ce,d as de}from"./cil-trash-BnkbpAXr.js";import{C as m}from"./CFormInput-CPK1Hc24.js";import{C as D,a as I,b as k,c as M}from"./CModalHeader-DM5zFOOe.js";import{C as ie}from"./CAlert-BYmA3n6A.js";import"./DefaultLayout-VGzP6Txu.js";const Ne=()=>{const[h,b]=n.useState([]),[c,w]=n.useState(null),[G,j]=n.useState(!1),[L,p]=n.useState(!1),[R,f]=n.useState(!1),[i,F]=n.useState({}),[d,x]=n.useState({nombre:"",contacto:"",correo:""}),[A,z]=n.useState(""),[q,B]=n.useState([]);n.useEffect(()=>{(async()=>{try{const o=await y.get("http://localhost:4000/proveedores");b(o.data)}catch(o){s("Error fetching proveedores: "+o.message)}})()},[]);const s=r=>{B([{message:r}]),setTimeout(()=>{B([])},3e3)},$=()=>{x({nombre:"",contacto:"",correo:""}),p(!0)},U=async()=>{const{nombre:r,contacto:o,correo:a}=d;if(!r.trim()){s("El nombre no puede estar vacío.");return}if(!o.trim()){s("El contacto no puede estar vacío.");return}if(!a.trim()){s("El correo no puede estar vacío.");return}if(!/\S+@\S+\.\S+/.test(a)){s("El formato del correo es incorrecto.");return}try{const t=await y.post("http://localhost:4000/proveedores",d);b([...h,t.data]),p(!1),x({nombre:"",contacto:"",correo:""})}catch(t){s("Error al agregar proveedor: "+t.message)}},W=async()=>{const{nombre:r,contacto:o,correo:a}=i;if(!r.trim()){s("El nombre no puede estar vacío.");return}if(!o.trim()){s("El contacto no puede estar vacío.");return}if(!a.trim()){s("El correo no puede estar vacío.");return}if(!/\S+@\S+\.\S+/.test(a)){s("El formato del correo es incorrecto.");return}try{const t=await y.put(`http://localhost:4000/proveedores/${c}`,i),C=h.map(u=>u.id===c?t.data:u);b(C),j(!1)}catch(t){s("Error al actualizar proveedor: "+t.message)}},J=async()=>{if(!c){s("No se ha seleccionado ningún proveedor.");return}try{await y.delete(`http://localhost:4000/proveedores/${c}`);const r=h.filter(o=>o.id!==c);b(r),w(null),f(!1)}catch(r){s("Error deleting proveedor: "+r.message)}},K=r=>{const o=h.find(a=>a.id===r);o?(F(o),w(r),j(!0)):s("Proveedor no encontrado.")},S=r=>{const{name:o,value:a}=r.target;F({...i,[o]:a})},O=()=>{const r=document.getElementById("table-to-pdf");_(r,{scale:2}).then(o=>{const a=o.toDataURL("image/png"),t=new ee("p","mm","a4"),C=210,u=295,v=o.height*C/o.width;let g=v,T=0;for(t.addImage(a,"PNG",0,T,C,v),g-=u;g>=0;)T=g-v,t.addPage(),t.addImage(a,"PNG",0,T,C,v),g-=u;t.save("proveedores.pdf")})},Q=r=>{z(r.target.value)},V=h.filter(r=>r.nombre.toLowerCase().includes(A.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx(re,{children:e.jsx(oe,{xs:12,children:e.jsxs(se,{className:"mb-4",children:[e.jsxs(te,{children:["Tabla de Proveedores",e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex",children:[e.jsxs(l,{color:"primary",onClick:$,className:"me-2",children:[e.jsx(E,{icon:ne})," Añadir"]}),e.jsxs(l,{color:"danger",onClick:()=>f(!0),disabled:c===null,className:"me-2",children:[e.jsx(E,{icon:le})," Eliminar"]}),e.jsxs(l,{color:"info",onClick:()=>K(c),disabled:c===null,className:"me-2",children:[e.jsx(E,{icon:ce})," Editar"]}),e.jsxs(l,{color:"success",onClick:O,children:[e.jsx(E,{icon:de})," Generar PDF"]})]}),e.jsx(m,{type:"text",placeholder:"Buscar por nombre",value:A,onChange:Q,className:"w-25"})]})]}),e.jsx(ae,{children:e.jsxs(X,{id:"table-to-pdf",align:"middle",className:"mb-0 border",hover:!0,responsive:!0,children:[e.jsx(Y,{className:"text-nowrap",children:e.jsxs(H,{children:[e.jsx(N,{className:"bg-body-tertiary text-center",children:"#"}),e.jsx(N,{className:"bg-body-tertiary",children:"Nombre"}),e.jsx(N,{className:"bg-body-tertiary",children:"Contacto"}),e.jsx(N,{className:"bg-body-tertiary",children:"Correo"})]})}),e.jsx(Z,{children:V.map((r,o)=>e.jsxs(H,{onClick:()=>w(r.id),className:r.id===c?"table-active":"",children:[e.jsx(P,{className:"text-center",children:o+1}),e.jsx(P,{children:r.nombre}),e.jsx(P,{children:r.contacto}),e.jsx(P,{children:r.correo})]},r.id))})]})})]})})}),e.jsxs(D,{visible:G,onClose:()=>j(!1),children:[e.jsx(I,{children:e.jsx("h5",{children:"Editar Proveedor"})}),e.jsx(k,{children:i&&e.jsxs(e.Fragment,{children:[e.jsx(m,{label:"Nombre",name:"nombre",value:i.nombre||"",onChange:S,className:"mb-2"}),e.jsx(m,{label:"Contacto",name:"contacto",value:i.contacto||"",onChange:S,className:"mb-2"}),e.jsx(m,{label:"Correo",name:"correo",value:i.correo||"",onChange:S,className:"mb-2"})]})}),e.jsxs(M,{children:[e.jsx(l,{color:"secondary",onClick:()=>j(!1),children:"Cerrar"}),e.jsx(l,{color:"primary",onClick:W,children:"Guardar Cambios"})]})]}),e.jsxs(D,{visible:L,onClose:()=>p(!1),children:[e.jsx(I,{children:e.jsx("h5",{children:"Agregar Proveedor"})}),e.jsxs(k,{children:[e.jsx(m,{label:"Nombre",value:d.nombre,onChange:r=>x({...d,nombre:r.target.value}),className:"mb-2"}),e.jsx(m,{label:"Contacto",value:d.contacto,onChange:r=>x({...d,contacto:r.target.value}),className:"mb-2"}),e.jsx(m,{label:"Correo",value:d.correo,onChange:r=>x({...d,correo:r.target.value}),className:"mb-2"})]}),e.jsxs(M,{children:[e.jsx(l,{color:"secondary",onClick:()=>p(!1),children:"Cerrar"}),e.jsx(l,{color:"primary",onClick:U,children:"Agregar Proveedor"})]})]}),e.jsxs(D,{visible:R,onClose:()=>f(!1),children:[e.jsx(I,{children:e.jsx("h5",{children:"Eliminar Proveedor"})}),e.jsx(k,{children:"¿Estás seguro de que quieres eliminar este proveedor?"}),e.jsxs(M,{children:[e.jsx(l,{color:"secondary",onClick:()=>f(!1),children:"Cancelar"}),e.jsx(l,{color:"danger",onClick:J,children:"Eliminar"})]})]}),e.jsx("div",{className:"position-fixed bottom-0 start-0 p-3",style:{zIndex:1550},children:q.map((r,o)=>e.jsx(ie,{color:"danger",className:"mb-2",style:{zIndex:1560},children:r.message},o))})]})};export{Ne as default};
